-- Whitelist table containing up to 10 Roblox User IDs (you can add more)
local Whitelist = {
    3648715092, -- Replace with actual Roblox User ID
    987654321, -- Replace with actual Roblox User ID
    111222333, -- Replace with actual Roblox User ID
    444555666, -- Replace with actual Roblox User ID
    777888999, -- Replace with actual Roblox User ID
    112233445, -- Replace with actual Roblox User ID
    556677889, -- Replace with actual Roblox User ID
    998877665, -- Replace with actual Roblox User ID
    123123123, -- Replace with actual Roblox User ID
    456456456  -- Replace with actual Roblox User ID
}

-- Function to check if a user is whitelisted
local function isWhitelisted(userId)
    for _, id in ipairs(Whitelist) do
        if id == userId then
            return true
        end
    end
    return false
end

-- Function to simulate a loading bar in the console
local function showLoadingBar()
    local steps = {"[          ]", "[==        ]", "[====      ]", "[======    ]", "[==========]"}
    for i, step in ipairs(steps) do
        print("Loading Script Data: " .. step)
        task.wait(1) -- Replace deprecated wait() with task.wait()
    end
    print("\27[32mLoading Script Data: [==========] Complete\27[0m") -- Green text for completion
end

-- Function to execute the loadstring script for whitelisted users
local function executeLoadstring(player)
    -- Replace with your actual loadstring URL or code
    local loadstringCode = [[
        -- Add your loadstring script logic here
        -- Example: loadstring(game:HttpGet("https://raw.githubusercontent.com/uhhhhh13/-/refs/heads/main/%E2%96%AA%EF%B8%8E"))()
        print("Loadstring executed for " .. player.Name)
    ]]
    
    local success, result = pcall(function()
        loadstring(loadstringCode)()
    end)
    
    if not success then
        warn("Error executing loadstring for " .. player.Name .. " | Error: " .. tostring(result))
        return false -- Exit if execution fails
    end
    return true
end

-- Main function to handle player joining
game.Players.PlayerAdded:Connect(function(player)
    local userId = player.UserId
    
    if isWhitelisted(userId) then
        showLoadingBar()
        task.wait(5) -- Wait 5 seconds after loading bar
        if not executeLoadstring(player) then
            player:Kick("An error occurred while loading your script. Contact an administrator.")
        end
    else
        print("User " .. player.Name .. " (ID: " .. userId .. ") is not whitelisted!")
        player:Kick("You are not whitelisted! Please contact the game administrator to gain access.")
    end
end)

-- Optional: Handle players already in the game when the script runs
for _, player in ipairs(game.Players:GetPlayers()) do
    local userId = player.UserId
    if isWhitelisted(userId) then
        showLoadingBar()
        task.wait(5)
        if not executeLoadstring(player) then
            player:Kick("An error occurred while loading your script. Contact an administrator.")
        end
    else
        print("User " .. player.Name .. " (ID: " .. userId .. ") is not whitelisted!")
        player:Kick("You are not whitelisted! Please contact the game administrator to gain access.")
    end
end
